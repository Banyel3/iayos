(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{4655:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>o});var l=r(4568),t=r(6006),n=r(7541),a=r(7620);let i=()=>{var e,s,r,i,o;let{data:c,status:d,update:u}=(0,t.useSession)(),x=(0,n.useRouter)(),[m,h]=(0,a.useState)(null),[f,b]=(0,a.useState)(!1),[g,j]=(0,a.useState)(3);if((0,a.useEffect)(()=>{var e,s;((null==c||null==(e=c.user)?void 0:e.profileType)==="WORKER"||(null==c||null==(s=c.user)?void 0:s.profileType)==="CLIENT")&&x.replace("/dashboard/profile")},[null==c||null==(e=c.user)?void 0:e.profileType,x]),(0,a.useEffect)(()=>{if("loading"!==d&&!c){let e=3;j(3);let s=setInterval(()=>{j(e-=1),e<=0&&(clearInterval(s),x.push("/auth/login"))},1e3);return()=>clearInterval(s)}},[c,d,x]),"loading"===d)return(0,l.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading session..."})]})});if(!c)return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsx)("div",{className:"bg-white rounded-2xl shadow-xl max-w-sm w-full mx-4 relative",children:(0,l.jsxs)("div",{className:"p-6 text-center",children:[(0,l.jsx)("div",{className:"mx-auto flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 6.5c-.77.833-.192 2.5 1.732 2.5z"})})}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 font-inter",children:"Access Denied"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4 font-inter",children:"You are not logged in. Redirecting to login page..."}),(0,l.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mb-4",children:(0,l.jsxs)("p",{className:"text-sm text-blue-800 font-inter",children:["Redirecting in"," ",(0,l.jsx)("span",{className:"font-bold text-blue-900",children:g})," ","second",1!==g?"s":""]})}),(0,l.jsx)("button",{onClick:()=>x.push("/auth/login"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200 font-inter",children:"Go to Login Now"})]})})}),(0,l.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-50 blur-sm",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Dashboard"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})})]});let v=async e=>{var s;if(e.preventDefault(),m){if(!(null==c||null==(s=c.user)?void 0:s.email)){console.error("No email found in session:",c),b(!1);return}b(!0);try{let e={selectedType:m,email:c.user.email};console.log("Sending request:",e);let s=await fetch("/api/auth/assign-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.ok)console.log("Profile type assigned successfully"),console.log("Refreshing session..."),await u(),console.log("Session refreshed, should redirect automatically");else{let e=await s.json();throw console.error("API Response Error:",e),Error(e.error||"An Error Occurred")}}catch(e){console.error("Error updating profile type:",e),b(!1)}}};return(0,l.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:(0,l.jsxs)("div",{className:"mx-auto max-w-[390px] min-h-screen flex flex-col justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-col justify-center flex-1 px-6",children:[(0,l.jsxs)("div",{className:"text-center mb-8",children:[(0,l.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(null==(s=c.user)?void 0:s.image)?(0,l.jsx)("img",{src:c.user.image,alt:"Profile",className:"w-16 h-16 rounded-full object-cover"}):(0,l.jsx)("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,l.jsxs)("h1",{className:"text-[28px] leading-[120%] font-[700] font-[Inter] text-black mb-2",children:["Welcome, ",(null==(i=c.user)||null==(r=i.name)?void 0:r.split(" ")[0])||"User","!"]}),(0,l.jsx)("p",{className:"text-gray-600 text-base leading-[150%]",children:"To get started, please choose how you'll be using iAyos"})]}),(0,l.jsxs)("form",{onSubmit:v,className:"space-y-6 mb-8",children:[(0,l.jsx)("div",{className:"bg-white rounded-2xl p-6 border-2 cursor-pointer transition-all duration-200 ".concat("CLIENT"===m?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 shadow-sm"),onClick:()=>h("CLIENT"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0 mr-4",children:(0,l.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat("CLIENT"===m?"border-blue-500 bg-blue-500":"border-gray-300"),children:"CLIENT"===m&&(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,l.jsx)("h3",{className:"text-lg font-[600] font-[Inter] text-black",children:"I need services"})]}),(0,l.jsx)("p",{className:"text-gray-600 text-sm leading-[140%] ml-15",children:"Find skilled workers for your projects. Post jobs and hire freelancers."})]})]})}),(0,l.jsx)("div",{className:"bg-white rounded-2xl p-6 border-2 cursor-pointer transition-all duration-200 ".concat("WORKER"===m?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-gray-300 shadow-sm"),onClick:()=>h("WORKER"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0 mr-4",children:(0,l.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat("WORKER"===m?"border-green-500 bg-green-500":"border-gray-300"),children:"WORKER"===m&&(0,l.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-3",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V4a2 2 0 00-2-2H6a2 2 0 00-2 2v2m8 0v2a2 2 0 01-2 2H8a2 2 0 01-2-2V6"})})}),(0,l.jsx)("h3",{className:"text-lg font-[600] font-[Inter] text-black",children:"I provide services"})]}),(0,l.jsx)("p",{className:"text-gray-600 text-sm leading-[140%] ml-15",children:"Showcase your skills and find clients. Build your freelance career."})]})]})}),(0,l.jsx)("button",{type:"submit",disabled:!m||f,className:"w-full py-4 rounded-xl font-[600] font-[Inter] text-white transition-all duration-200 ".concat(m&&!f?"bg-black hover:bg-gray-800 cursor-pointer":"bg-gray-400 cursor-not-allowed"),children:f?(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,l.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,l.jsx)("span",{children:"Setting up your account..."})]}):"Continue"})]}),(0,l.jsxs)("div",{className:"text-center text-sm text-gray-500 mb-4",children:["Signed in as: ",null==(o=c.user)?void 0:o.email]})]}),(0,l.jsx)("div",{className:"p-6 text-center",children:(0,l.jsx)("button",{onClick:()=>(0,t.signOut)({callbackUrl:"/onboard"}),className:"text-gray-400 text-sm underline hover:text-gray-600 transition-colors",children:"Sign Out"})})]})})},o=()=>(0,l.jsx)(i,{})},5267:(e,s,r)=>{Promise.resolve().then(r.bind(r,4655))},7541:(e,s,r)=>{"use strict";var l=r(3041);r.o(l,"usePathname")&&r.d(s,{usePathname:function(){return l.usePathname}}),r.o(l,"useRouter")&&r.d(s,{useRouter:function(){return l.useRouter}}),r.o(l,"useSearchParams")&&r.d(s,{useSearchParams:function(){return l.useSearchParams}})}},e=>{e.O(0,[6006,587,18,7358],()=>e(e.s=5267)),_N_E=e.O()}]);