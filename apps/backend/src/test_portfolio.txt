python : Using existing test database for alias 'default'...
At line:1 char:1
+ python manage.py test accounts.tests.test_portfolio_service --keepdb  ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (Using existing ...as 'default'...:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 

.....EE.Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\iayos_project\utils.py", line 15, in upload_file
    result = settings.SUPABASE.storage.from_(bucket).upload(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'from_'
ETraceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\iayos_project\utils.py", line 15, in upload_file
    result = settings.SUPABASE.storage.from_(bucket).upload(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'function' object has no attribute 'from_'
EFFEE
======================================================================
ERROR: test_reorder_portfolio_valid_order 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_reorder_portfolio_valid_order)
Test reordering portfolio items
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 165, in 
test_reorder_portfolio_valid_order
    self.assertEqual(result[0]["portfolioID"], item3.portfolioID)
                     ~~~~~~^^^
KeyError: 0

======================================================================
ERROR: test_update_portfolio_caption_not_owner 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_update_portfolio_caption_not_owner)
Test that user cannot update another user's portfolio
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
psycopg2.errors.NotNullViolation: null value in column "birthDate" of relation "accounts_profile" violates not-null 
constraint
DETAIL:  Failing row contains (60, null, Other, Worker, , null, WORKER, 60, null, null, f, null, null).


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 123, in 
test_update_portfolio_caption_not_owner
    other_profile = Profile.objects.create(
        accountFK=other_user,
    ...<2 lines>...
        profileType="WORKER"
    )
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\query.py", line 665, in create
    obj.save(force_insert=True, using=self.db)
    ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\base.py", line 1169, in _save_table
    results = self._do_insert(
        cls._base_manager, using, fields, returning_fields, raw
    )
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\base.py", line 1210, in _do_insert
    return manager._insert(
           ~~~~~~~~~~~~~~~^
        [self],
        ^^^^^^^
    ...<3 lines>...
        raw=raw,
        ^^^^^^^^
    )
    ^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\query.py", line 1873, in _insert
    return query.get_compiler(using=using).execute_sql(returning_fields)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\models\sql\compiler.py", line 1882, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\backends\utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\backends\utils.py", line 92, in 
_execute_with_wrappers
    return executor(sql, params, many, context)
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\backends\utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "C:\code\iayos\apps\backend\venv\Lib\site-packages\django\db\backends\utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
django.db.utils.IntegrityError: null value in column "birthDate" of relation "accounts_profile" violates not-null 
constraint
DETAIL:  Failing row contains (60, null, Other, Worker, , null, WORKER, 60, null, null, f, null, null).


======================================================================
ERROR: test_upload_portfolio_image_auto_order 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_upload_portfolio_image_auto_order)
Test that display_order is automatically incremented
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 56, in upload_portfolio_image
    raise ValueError("Failed to upload portfolio image")
ValueError: Failed to upload portfolio image

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 70, in 
test_upload_portfolio_image_auto_order
    result = upload_portfolio_image(self.worker_profile, mock_file, "Second project")
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 58, in upload_portfolio_image
    raise ValueError(f"Portfolio upload failed: {str(e)}")
ValueError: Portfolio upload failed: Failed to upload portfolio image

======================================================================
ERROR: test_upload_portfolio_image_success 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_upload_portfolio_image_success)
Test uploading a portfolio image
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 56, in upload_portfolio_image
    raise ValueError("Failed to upload portfolio image")
ValueError: Failed to upload portfolio image

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 46, in 
test_upload_portfolio_image_success
    result = upload_portfolio_image(
        self.worker_profile,
        mock_file,
        caption="Completed electrical installation"
    )
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 58, in upload_portfolio_image
    raise ValueError(f"Portfolio upload failed: {str(e)}")
ValueError: Portfolio upload failed: Failed to upload portfolio image

======================================================================
ERROR: test_validate_image_file_valid_jpeg 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_validate_image_file_valid_jpeg)
Test validation passes for valid JPEG
----------------------------------------------------------------------
Traceback (most recent call last):
Γ£ô Supabase client initialized successfully with secret API key
Found 14 test(s).
System check identified no issues (0 silenced).
Γ¥î Upload exception: 'function' object has no attribute 'from_'
Γ¥î Upload exception: 'function' object has no attribute 'from_'
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 254, in 
test_validate_image_file_valid_jpeg
    validate_image_file(mock_file)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 289, in validate_image_file
    extension = '.' + file_name.split('.')[-1].lower() if '.' in file_name else ''
                                                          ^^^^^^^^^^^^^^^^
TypeError: argument of type 'Mock' is not iterable

======================================================================
ERROR: test_validate_image_file_valid_png 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_validate_image_file_valid_png)
Test validation passes for valid PNG
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 263, in 
test_validate_image_file_valid_png
    validate_image_file(mock_file)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\code\iayos\apps\backend\src\accounts\portfolio_service.py", line 289, in validate_image_file
    extension = '.' + file_name.split('.')[-1].lower() if '.' in file_name else ''
                                                          ^^^^^^^^^^^^^^^^
TypeError: argument of type 'Mock' is not iterable

======================================================================
FAIL: test_validate_image_file_invalid_type 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_validate_image_file_invalid_type)
Test image file type validation
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 242, in 
test_validate_image_file_invalid_type
    with self.assertRaises(ValueError) as context:
         ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
AssertionError: ValueError not raised

======================================================================
FAIL: test_validate_image_file_size_exceeded 
(accounts.tests.test_portfolio_service.PortfolioServiceTestCase.test_validate_image_file_size_exceeded)
Test image file size validation
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\code\iayos\apps\backend\src\accounts\tests\test_portfolio_service.py", line 231, in 
test_validate_image_file_size_exceeded
    with self.assertRaises(ValueError) as context:
         ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
AssertionError: ValueError not raised

----------------------------------------------------------------------
Ran 14 tests in 19.628s

FAILED (failures=2, errors=6)
Preserving test database for alias 'default'...

