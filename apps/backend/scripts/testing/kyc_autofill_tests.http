# KYC Auto-Fill API Tests
# Tests for the new KYC extraction and auto-fill endpoints

@baseUrl = http://localhost:8000
@adminEmail = admin@iayos.com
@adminPassword = admin123
@testUserEmail = worker1@test.com
@testUserPassword = test123

### ============================================
### 1. LOGIN AS TEST USER
### ============================================

# @name login
POST {{baseUrl}}/api/accounts/login
Content-Type: application/json

{
    "email": "{{testUserEmail}}",
    "password": "{{testUserPassword}}"
}

### ============================================
### 2. GET KYC AUTO-FILL DATA
### ============================================

# @name getAutofillData
# Fetches AI-extracted KYC data for mobile auto-fill
# Returns extracted fields with confidence scores

GET {{baseUrl}}/api/accounts/kyc/autofill
Cookie: access_token={{login.response.body.access_token}}

### ============================================
### 3. CONFIRM KYC EXTRACTED DATA
### ============================================

# @name confirmKycData
# User confirms or edits extracted data
# Saves confirmed values for admin review

POST {{baseUrl}}/api/accounts/kyc/confirm
Cookie: access_token={{login.response.body.access_token}}
Content-Type: application/json

{
    "full_name": "Juan Dela Cruz",
    "first_name": "Juan",
    "middle_name": "Santos",
    "last_name": "Dela Cruz",
    "birth_date": "1990-05-15",
    "address": "123 Main Street, Tetuan, Zamboanga City",
    "id_number": "A1234567"
}

### ============================================
### 4. GET KYC COMPARISON DATA
### ============================================

# @name getComparisonData
# Get side-by-side comparison of extracted vs confirmed values
# Useful for admin review

GET {{baseUrl}}/api/accounts/kyc/comparison
Cookie: access_token={{login.response.body.access_token}}

### ============================================
### 5. GET KYC STATUS (WITH EXTRACTED DATA)
### ============================================

# @name getKycStatus
# Check overall KYC status

GET {{baseUrl}}/api/accounts/kyc-status
Cookie: access_token={{login.response.body.access_token}}

### ============================================
### MOBILE API TESTS (Bearer Token)
### ============================================

### 6. LOGIN VIA MOBILE API
# @name mobileLogin
POST {{baseUrl}}/api/mobile/auth/login
Content-Type: application/json

{
    "email": "{{testUserEmail}}",
    "password": "{{testUserPassword}}"
}

### 7. GET AUTO-FILL DATA (MOBILE)
# @name mobileAutofill
GET {{baseUrl}}/api/accounts/kyc/autofill
Authorization: Bearer {{mobileLogin.response.body.access_token}}

### 8. CONFIRM DATA (MOBILE)
# @name mobileConfirm
POST {{baseUrl}}/api/accounts/kyc/confirm
Authorization: Bearer {{mobileLogin.response.body.access_token}}
Content-Type: application/json

{
    "full_name": "Juan Dela Cruz",
    "first_name": "Juan",
    "middle_name": "Santos",
    "last_name": "Dela Cruz",
    "birth_date": "1990-05-15",
    "address": "123 Main Street, Tetuan, Zamboanga City",
    "id_number": "A1234567"
}

### ============================================
### ERROR CASES
### ============================================

### 9. AUTO-FILL WITHOUT AUTH (401)
# @name autofillNoAuth
GET {{baseUrl}}/api/accounts/kyc/autofill

### 10. CONFIRM WITH INVALID DATA
# @name confirmInvalidData
POST {{baseUrl}}/api/accounts/kyc/confirm
Cookie: access_token={{login.response.body.access_token}}
Content-Type: application/json

{
    "birth_date": "invalid-date"
}

### ============================================
### ADMIN TESTS
### ============================================

### 11. LOGIN AS ADMIN
# @name adminLogin
POST {{baseUrl}}/api/accounts/login
Content-Type: application/json

{
    "email": "{{adminEmail}}",
    "password": "{{adminPassword}}"
}

### 12. GET PENDING KYC SUBMISSIONS (ADMIN)
# @name adminPendingKyc
GET {{baseUrl}}/api/adminpanel/kyc/pending
Cookie: access_token={{adminLogin.response.body.access_token}}

### 13. GET KYC DETAIL WITH EXTRACTED DATA (ADMIN)
# Replace {kyc_id} with actual ID from pending list
# @name adminKycDetail
GET {{baseUrl}}/api/adminpanel/kyc/{kyc_id}
Cookie: access_token={{adminLogin.response.body.access_token}}

### ============================================
### WEB ACCESS ROLE TESTS
### ============================================

### 14. WORKER LOGIN (Should be blocked from web dashboard)
# @name workerLogin
POST {{baseUrl}}/api/accounts/login
Content-Type: application/json

{
    "email": "worker@test.com",
    "password": "test123"
}

### 15. CHECK WORKER PROFILE TYPE
# @name workerMe
# Should return profile_type: "WORKER"
GET {{baseUrl}}/api/accounts/me
Cookie: access_token={{workerLogin.response.body.access_token}}

### 16. CLIENT LOGIN
# @name clientLogin
POST {{baseUrl}}/api/accounts/login
Content-Type: application/json

{
    "email": "client@test.com",
    "password": "test123"
}

### 17. CHECK CLIENT PROFILE TYPE
# @name clientMe
# Should return profile_type: "CLIENT"
GET {{baseUrl}}/api/accounts/me
Cookie: access_token={{clientLogin.response.body.access_token}}

### 18. AGENCY LOGIN (Should have web access)
# @name agencyLogin
POST {{baseUrl}}/api/accounts/login
Content-Type: application/json

{
    "email": "agency@test.com",
    "password": "test123"
}

### 19. CHECK AGENCY ACCOUNT TYPE
# @name agencyMe
# Should return accountType: "agency"
GET {{baseUrl}}/api/accounts/me
Cookie: access_token={{agencyLogin.response.body.access_token}}
